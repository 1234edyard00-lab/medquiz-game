<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MedQuiz: –û—Ç —Å–∞–Ω–∏—Ç–∞—Ä–∞ –¥–æ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞</title>
    
    <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta name="theme-color" content="#8a2be2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MedQuiz">
    <meta name="description" content="–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞–Ω–∏—è –ø–æ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- –ò–∫–æ–Ω–∫–∏ -->
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFHSURBVHgB7ZaxTsMwEIYjJWx5AibkyYwxLyDkCdJ36EP0ITD0JTD1JRqJh1CaWcqSSMhKjCwrqZStc46Tf+SZfne+732ObdugtZZfK8QQrKorS3EF8BoKRk3JBcCTJTilPfg1nQBPnqEJGjoCnjzBPd3ADT3CKT3DLW3BNj3DPg3hhm7glN7BecUG7OicKlSgIdTQhgWpaAcaGrDF/7LAa61v6q4FAx7gldbggwp0XmyQAu/RDJaowL8WzOIDdsDv0Ab4q1gDf1yxAv7yZgb8GcoE+D0vAf5YTIG/niLAX1U54D8JhIC/v1LAP7JSwH/aSgH/iU0B/x2SAv5/hRjwT0gM+Kc4Bvz3Jgb8a48B/4/GgP8PwYD/l2PA/ytjwP+HY8D/B2TA/2djwP/PxID/D8yA/xeAAf9fEwb8v6IY8P9qY8D/K8+A/wUx4P9TMeD/QzLg/8My4P8VM+B/wQz4XxID/nfFgP+tMeB/bwz4Xx0D/rfHgP8N/leA/HgDlA7KkYhDoUIAAAAASUVORK5CYII=">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <style>
        /* –í–ê–® –°–¢–ò–õ–¨–ù–´–ô –ö–û–î –û–°–¢–ê–ï–¢–°–Ø –ü–û–õ–ù–û–°–¢–¨–Æ –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
        :root {
            --lavender: #e6e6fa;
            --lilac: #c8a2c8;
            --violet: #8a2be2;
            --mint: #a7ffeb;
            --cream: #fffdd0;
            --gold: #ffd700;
            --error: #ff6b6b;
            --success: #51cf66;
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--lavender), var(--lilac));
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: var(--safe-area-inset-top);
            padding-bottom: var(--safe-area-inset-bottom);
        }
        
        /* ... –í–°–ï –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô ... */
        
        /* –î–æ–±–∞–≤–∏–º —Å—Ç–∏–ª—å –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .offline-notice {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ffd700;
            color: #333;
            text-align: center;
            padding: 8px;
            font-size: 14px;
            z-index: 9999;
            display: none;
            font-weight: bold;
        }
        
        .offline-notice.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.15);
            z-index: 9998;
            display: none;
            max-width: 90%;
            width: 400px;
            text-align: center;
            border: 2px solid var(--violet);
        }
        
        .install-prompt.show {
            display: block;
            animation: fadeInUp 0.3s ease-out;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateX(-50%) translateY(20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        
        .install-btn {
            background: linear-gradient(to right, var(--violet), var(--lilac));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: bold;
        }
        
        .install-close {
            background: #f1f1f1;
            color: #666;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px 5px;
        }
    </style>
</head>
<body>
    <!-- –û—Ñ—Ñ–ª–∞–π–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="offline-notice" id="offline-notice">
        ‚ö†Ô∏è –í—ã –≤ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ. –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞!
    </div>
    
    <!-- –ü—Ä–æ–º–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA -->
    <div class="install-prompt" id="install-prompt">
        <p>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MedQuiz –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?</p>
        <p><small>–†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω, –±—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è</small></p>
        <div>
            <button class="install-btn" id="install-btn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            <button class="install-close" id="install-close">–ü–æ–∑–∂–µ</button>
        </div>
    </div>
    
    <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    
    <div class="game-container">
        <!-- Header with game stats -->
        <div class="header">
            <div class="brand">
                <div class="brand-logo">SS</div>
                <div class="brand-text">
                    <h1>MedQuiz</h1>
                    <p>–û—Ç —Å–∞–Ω–∏—Ç–∞—Ä–∞ –¥–æ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä–∞</p>
                </div>
            </div>
            
            <div class="game-stats">
                <div class="lives">
                    <div class="life active"></div>
                    <div class="life active"></div>
                    <div class="life active"></div>
                </div>
                <div class="score">0</div>
            </div>
        </div>
        
        <!-- Main game area -->
        <div class="game-area">
            <!-- Welcome screen -->
            <div class="welcome-screen" id="welcome-screen">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MedQuiz!</h2>
                <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–∏ –∑–Ω–∞–Ω–∏—è –ø–æ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ. –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –ø–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –¥–æ—Å—Ç–∏—á—å –∑–≤–∞–Ω–∏—è <strong>–ê–∫–∞–¥–µ–º–∏–∫–∞</strong>!</p>
                <p>–í –∏–≥—Ä–µ –≤–∞—Å –∂–¥—É—Ç 15 –≤–æ–ø—Ä–æ—Å–æ–≤, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–æ–Ω—Å–ø–µ–∫—Ç–µ Sea.School. –£ –≤–∞—Å –µ—Å—Ç—å 3 –∂–∏–∑–Ω–∏ –∏ 3 –ø–æ–¥—Å–∫–∞–∑–∫–∏. –£–¥–∞—á–∏!</p>
                <button class="start-btn" id="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                
                <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞ -->
                <div id="offline-indicator" style="margin-top: 15px; font-size: 14px; color: #666; display: none;">
                    üì± –î–æ—Å—Ç—É–ø–Ω–∞ –æ—Ñ—Ñ–ª–∞–π–Ω-–≤–µ—Ä—Å–∏—è
                </div>
            </div>
            
            <!-- Question screen -->
            <div class="question-screen" id="question-screen">
                <div class="progress-container">
                    <div class="progress-text">
                        <span>–í–æ–ø—Ä–æ—Å <span id="current-question">1</span>/15</span>
                        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="progress-percent">0</span>%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                </div>
                
                <div class="question-container">
                    <div class="question-text" id="question-text">–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
                </div>
                
                <div class="answers-container" id="answers-container">
                    <!-- Answers will be inserted here by JavaScript -->
                </div>
                
                <div class="hints-container">
                    <button class="hint-btn" id="hint-50">
                        <span>50/50</span>
                        <span id="hint-50-count">(1)</span>
                    </button>
                    <button class="hint-btn" id="hint-cheat">
                        <span>–®–ø–∞—Ä–≥–∞–ª–∫–∞</span>
                        <span id="hint-cheat-count">(1)</span>
                    </button>
                    <button class="hint-btn" id="hint-audience">
                        <span>–ü–æ–º–æ—â—å –∫–ª–∞—Å—Å–∞</span>
                        <span id="hint-audience-count">(1)</span>
                    </button>
                </div>
            </div>
            
            <!-- Results screen -->
            <div class="results-screen" id="results-screen">
                <h2 class="rank-title" id="rank-title">–°–∞–Ω–∏—Ç–∞—Ä</h2>
                <div class="rank-image" id="rank-image">üë®‚Äç‚öïÔ∏è</div>
                <p class="rank-description" id="rank-description">–ù—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª! –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–µ–Ω–µ–µ —á–µ–º –Ω–∞ 50% –≤–æ–ø—Ä–æ—Å–æ–≤.</p>
                
                <div class="results-details">
                    <div class="result-item">
                        <div class="result-value" id="final-score">0</div>
                        <div class="result-label">–û—á–∫–∏</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="correct-answers">0</div>
                        <div class="result-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</div>
                    </div>
                    <div class="result-item">
                        <div class="result-value" id="lives-left">0</div>
                        <div class="result-label">–û—Å—Ç–∞–ª–æ—Å—å –∂–∏–∑–Ω–µ–π</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn restart-btn" id="restart-btn">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    <button class="action-btn telegram-btn" id="telegram-btn">Telegram –∫–∞–Ω–∞–ª</button>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
                <div id="save-indicator" style="margin-top: 15px; font-size: 12px; color: #888;">
                    –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                </div>
            </div>
        </div>
        
        <!-- Confetti container -->
        <div class="confetti-container" id="confetti-container"></div>
        
        <!-- Footer -->
        <div class="footer">
            <p>–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è <strong>Sea.School</strong> | <a href="https://t.me/sea_sch" target="_blank" id="telegram-link">–ë–æ–ª—å—à–µ —É—Ä–æ–∫–æ–≤ –≤ –Ω–∞—à–µ–º Telegram-–∫–∞–Ω–∞–ª–µ: @sea_sch</a></p>
            <p style="margin-top: 5px; font-size: 0.75rem;">‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ—Ñ–ª–∞–π–Ω</p>
        </div>
    </div>

    <script>
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ', registration.scope);
                        document.getElementById('offline-indicator').style.display = 'block';
                    })
                    .catch(function(err) {
                        console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ServiceWorker: ', err);
                    });
            });
        }
        
        // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
        function updateOnlineStatus() {
            const offlineNotice = document.getElementById('offline-notice');
            if (!navigator.onLine) {
                offlineNotice.classList.add('show');
            } else {
                offlineNotice.classList.remove('show');
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus(); // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        
        // –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const SAVE_KEY = 'medquiz_save';
        
        function saveGame() {
            const gameState = {
                currentQuestionIndex,
                score,
                lives,
                hints,
                timestamp: Date.now()
            };
            localStorage.setItem(SAVE_KEY, JSON.stringify(gameState));
        }
        
        function loadGame() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                try {
                    const state = JSON.parse(saved);
                    // –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –∏–≥—Ä–∞ –Ω–∞–π–¥–µ–Ω–∞:', state);
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
        let deferredPrompt;
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');
        const installClose = document.getElementById('install-close');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∫–∞–∑ –ø—Ä–æ–º–ø—Ç–∞
            e.preventDefault();
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–∑–∂–µ
            deferredPrompt = e;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (deferredPrompt && !isAppInstalled()) {
                    installPrompt.classList.add('show');
                }
            }, 3000);
        });
        
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            deferredPrompt.prompt();
            
            // –ñ–¥–µ–º –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–∏–ª PWA');
            } else {
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è –æ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏');
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –Ω–∞—à –ø—Ä–æ–º–ø—Ç
            installPrompt.classList.remove('show');
            deferredPrompt = null;
        });
        
        installClose.addEventListener('click', () => {
            installPrompt.classList.remove('show');
            // –°–∫—Ä—ã—Ç—å –Ω–∞ 7 –¥–Ω–µ–π
            localStorage.setItem('installPromptHidden', Date.now() + 7 * 24 * 60 * 60 * 1000);
        });
        
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone ||
                   document.referrer.includes('android-app://');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç
        function shouldShowInstallPrompt() {
            const hiddenUntil = localStorage.getItem('installPromptHidden');
            if (!hiddenUntil) return true;
            return Date.now() > parseInt(hiddenUntil);
        }
        
        // –í–ê–® –û–°–ù–û–í–ù–û–ô –ö–û–î –ò–ì–†–´ –ù–ò–ñ–ï (–ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô)
        // Detect if running in Telegram WebApp
        const isTelegramWebApp = window.Telegram && window.Telegram.WebApp;
        
        // Add class for Telegram-specific styling
        if (isTelegramWebApp) {
            document.body.classList.add('telegram-webapp');
            Telegram.WebApp.expand(); // Expand WebApp to full height
            Telegram.WebApp.setHeaderColor('#8a2be2'); // Set header color to violet
            Telegram.WebApp.setBackgroundColor('#e6e6fa'); // Set background to lavender
            Telegram.WebApp.enableClosingConfirmation(); // Ask before closing
        }
        
        // Game data - questions from the provided PDF content
        const quizData = [
            {
                question: "–°–∫–æ–ª—å–∫–æ –∫–∞–º–µ—Ä –≤ —Å–µ—Ä–¥—Ü–µ —á–µ–ª–æ–≤–µ–∫–∞?",
                answers: ["2", "3", "4", "5"],
                correctAnswer: 2,
                hint: "–°–µ—Ä–¥—Ü–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 4-—Ö –∫–∞–º–µ—Ä: 2 –ø—Ä–µ–¥—Å–µ—Ä–¥–∏—è –∏ 2 –∂–µ–ª—É–¥–æ—á–∫–∞."
            },
            {
                question: "–ö–∞–∫–æ–π –∫–ª–∞–ø–∞–Ω —Ä–∞–∑–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–æ–µ –ø—Ä–µ–¥—Å–µ—Ä–¥–∏–µ –∏ –∂–µ–ª—É–¥–æ—á–µ–∫?",
                answers: ["–ú–∏—Ç—Ä–∞–ª—å–Ω—ã–π", "–ê–æ—Ä—Ç–∞–ª—å–Ω—ã–π", "–¢—Ä–∏–∫—É—Å–ø–∏–¥–∞–ª—å–Ω—ã–π", "–õ–µ–≥–æ—á–Ω—ã–π"],
                correctAnswer: 2,
                hint: "–¢—Ä–∏–∫—É—Å–ø–∏–¥–∞–ª—å–Ω—ã–π –∫–ª–∞–ø–∞–Ω —Ä–∞–∑–¥–µ–ª—è–µ—Ç –ø—Ä–∞–≤–æ–µ –ø—Ä–µ–¥—Å–µ—Ä–¥–∏–µ –∏ –∂–µ–ª—É–¥–æ—á–µ–∫."
            },
            {
                question: "–ö–∞–∫–æ–π —Å–ª–æ–π —Å—Ç–µ–Ω–∫–∏ —Å–µ—Ä–¥—Ü–∞ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è?",
                answers: ["–≠–ø–∏–∫–∞—Ä–¥", "–ú–∏–æ–∫–∞—Ä–¥", "–≠–Ω–¥–æ–∫–∞—Ä–¥", "–ü–µ—Ä–∏–∫–∞—Ä–¥"],
                correctAnswer: 1,
                hint: "–ú–∏–æ–∫–∞—Ä–¥ ‚Äî —ç—Ç–æ —Å–µ—Ä–¥–µ—á–Ω–∞—è –º—ã—à—Ü–∞, –æ—Ç–≤–µ—á–∞—é—â–∞—è –∑–∞ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å–µ—Ä–¥—Ü–∞."
            },
            {
                question: "–°–∫–æ–ª—å–∫–æ –¥–ª–∏—Ç—Å—è —Å–µ—Ä–¥–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤ –ø–æ–∫–æ–µ?",
                answers: ["0.4 —Å", "0.6 —Å", "0.8 —Å", "1.0 —Å"],
                correctAnswer: 2,
                hint: "–°–µ—Ä–¥–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª–∏—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ 0.8 —Å–µ–∫—É–Ω–¥—ã."
            },
            {
                question: "–ö–∞–∫–æ–π —É–∑–µ–ª —è–≤–ª—è–µ—Ç—Å—è –≤–æ–¥–∏—Ç–µ–ª–µ–º —Ä–∏—Ç–º–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞?",
                answers: ["–ê—Ç—Ä–∏–æ–≤–µ–Ω—Ç—Ä–∏–∫—É–ª—è—Ä–Ω—ã–π", "–°–∏–Ω–æ–∞—Ç—Ä–∏–∞–ª—å–Ω—ã–π", "–ü—É—á–æ–∫ –ì–∏—Å–∞", "–í–æ–ª–æ–∫–Ω–∞ –ü—É—Ä–∫–∏–Ω—å–µ"],
                correctAnswer: 1,
                hint: "–°–∏–Ω–æ–∞—Ç—Ä–∏–∞–ª—å–Ω—ã–π —É–∑–µ–ª ‚Äî –≤–æ–¥–∏—Ç–µ–ª—å —Ä–∏—Ç–º–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞."
            },
            {
                question: "–ö–∞–∫–æ–π –≥–æ—Ä–º–æ–Ω —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É —Å–µ—Ä–¥—Ü–∞?",
                answers: ["–ò–Ω—Å—É–ª–∏–Ω", "–¢–∏—Ä–æ–∫—Å–∏–Ω", "–ö–æ—Ä—Ç–∏–∑–æ–ª", "–ú–µ–ª–∞—Ç–æ–Ω–∏–Ω"],
                correctAnswer: 1,
                hint: "–¢–∏—Ä–æ–∫—Å–∏–Ω —É—Å–∫–æ—Ä—è–µ—Ç —Ä–∏—Ç–º —Å–µ—Ä–¥—Ü–∞."
            },
            {
                question: "–ö–∞–∫–æ–π —Ç–∏–ø —Å–æ—Å—É–¥–æ–≤ –Ω–µ—Å–µ—Ç –∫—Ä–æ–≤—å –æ—Ç —Å–µ—Ä–¥—Ü–∞?",
                answers: ["–í–µ–Ω—ã", "–ê—Ä—Ç–µ—Ä–∏–∏", "–ö–∞–ø–∏–ª–ª—è—Ä—ã", "–õ–∏–º—Ñ–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ—Å—É–¥—ã"],
                correctAnswer: 1,
                hint: "–ê—Ä—Ç–µ—Ä–∏–∏ –Ω–µ—Å—É—Ç –∫—Ä–æ–≤—å –û–¢ —Å–µ—Ä–¥—Ü–∞."
            },
            {
                question: "–ö–∞–∫–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–≤–∏–∂–µ–Ω–∏—è –∫—Ä–æ–≤–∏ —Å–æ–∑–¥–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ?",
                answers: ["–†–∞–∑–Ω–æ—Å—Ç—å –¥–∞–≤–ª–µ–Ω–∏–π", "–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –º—ã—à—Ü", "–°–µ—Ä–¥—Ü–µ", "–ö–ª–∞–ø–∞–Ω—ã –≤–µ–Ω"],
                correctAnswer: 2,
                hint: "–°–µ—Ä–¥—Ü–µ —Å–æ–∑–¥–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–µ, –ø—É–ª—å—Å–∏—Ä—É—é—â–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ."
            },
            {
                question: "–ö–∞–∫–∞—è –Ω–æ—Ä–º–∞ —á–∞—Å—Ç–æ—Ç—ã —Å–µ—Ä–¥–µ—á–Ω—ã—Ö —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π –≤ –ø–æ–∫–æ–µ —É –≤–∑—Ä–æ—Å–ª—ã—Ö?",
                answers: ["40-60 —É–¥/–º–∏–Ω", "60-100 —É–¥/–º–∏–Ω", "100-120 —É–¥/–º–∏–Ω", "120-140 —É–¥/–º–∏–Ω"],
                correctAnswer: 1,
                hint: "–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—É–ª—å—Å –≤ –ø–æ–∫–æ–µ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö: 60-100 —É–¥–∞—Ä–æ–≤ –≤ –º–∏–Ω—É—Ç—É."
            },
            {
                question: "–ì–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –±–æ–ª—å—à–æ–π –∫—Ä—É–≥ –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è?",
                answers: ["–í –ø—Ä–∞–≤–æ–º –∂–µ–ª—É–¥–æ—á–∫–µ", "–í –ª–µ–≤–æ–º –∂–µ–ª—É–¥–æ—á–∫–µ", "–í –ø—Ä–∞–≤–æ–º –ø—Ä–µ–¥—Å–µ—Ä–¥–∏–∏", "–í –ª–µ–≤–æ–º –ø—Ä–µ–¥—Å–µ—Ä–¥–∏–∏"],
                correctAnswer: 1,
                hint: "–ë–æ–ª—å—à–æ–π –∫—Ä—É–≥ –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ –ª–µ–≤–æ–º –∂–µ–ª—É–¥–æ—á–∫–µ."
            },
            {
                question: "–ö—Ç–æ –æ—Ç–∫—Ä—ã–ª –±–æ–ª—å—à–æ–π –∫—Ä—É–≥ –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è?",
                answers: ["–ú–∏–≥–µ–ª—å –°–µ—Ä–≤–µ—Ç", "–£–∏–ª—å—è–º –ì–∞—Ä–≤–µ–π", "–ò–≤–∞–Ω –ü–∞–≤–ª–æ–≤", "–ù–∏–∫–æ–ª–∞–π –ü–∏—Ä–æ–≥–æ–≤"],
                correctAnswer: 1,
                hint: "–£–∏–ª—å—è–º –ì–∞—Ä–≤–µ–π –æ—Ç–∫—Ä—ã–ª –±–æ–ª—å—à–æ–π –∫—Ä—É–≥ –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è."
            },
            {
                question: "–ü—Ä–∏ –∫–∞–∫–æ–º –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–∏ –∂–≥—É—Ç –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç –≤—ã—à–µ –º–µ—Å—Ç–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è?",
                answers: ["–í–µ–Ω–æ–∑–Ω–æ–º", "–ê—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–º", "–ö–∞–ø–∏–ª–ª—è—Ä–Ω–æ–º", "–ü–∞—Ä–µ–Ω—Ö–∏–º–∞—Ç–æ–∑–Ω–æ–º"],
                correctAnswer: 1,
                hint: "–ü—Ä–∏ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–º –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–∏ –∂–≥—É—Ç –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç –≤—ã—à–µ –º–µ—Å—Ç–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è."
            },
            {
                question: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∞—Ç–µ—Ä–æ—Å–∫–ª–µ—Ä–æ–∑?",
                answers: [
                    "–í–æ—Å–ø–∞–ª–µ–Ω–∏–µ —Å–µ—Ä–¥–µ—á–Ω–æ–π –º—ã—à—Ü—ã",
                    "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω–æ–≤—ã—Ö –±–ª—è—à–µ–∫ –Ω–∞ —Å—Ç–µ–Ω–∫–∞—Ö –∞—Ä—Ç–µ—Ä–∏–π",
                    "–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–µ–Ω",
                    "–ù–∞—Ä—É—à–µ–Ω–∏–µ —Å–µ—Ä–¥–µ—á–Ω–æ–≥–æ —Ä–∏—Ç–º–∞"
                ],
                correctAnswer: 1,
                hint: "–ê—Ç–µ—Ä–æ—Å–∫–ª–µ—Ä–æ–∑ ‚Äî –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∂–∏—Ä–æ–≤—ã—Ö –±–ª—è—à–µ–∫ –∏–∑ —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω–∞ –Ω–∞ —Å—Ç–µ–Ω–∫–∞—Ö –∞—Ä—Ç–µ—Ä–∏–π."
            },
            {
                question: "–ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç–µ–Ω–æ–∫–∞—Ä–¥–∏—è?",
                answers: [
                    "–í–æ—Å–ø–∞–ª–µ–Ω–∏–µ —Å–µ—Ä–¥–µ—á–Ω–æ–π —Å—É–º–∫–∏",
                    "–ë–æ–ª–∏ –≤ –≥—Ä—É–¥–∏ –∏–∑-–∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –≤ —Å–µ—Ä–¥—Ü–µ",
                    "–ù–∞—Ä—É—à–µ–Ω–∏–µ —Å–µ—Ä–¥–µ—á–Ω–æ–≥–æ —Ä–∏—Ç–º–∞",
                    "–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–∞–º–µ—Ä —Å–µ—Ä–¥—Ü–∞"
                ],
                correctAnswer: 1,
                hint: "–°—Ç–µ–Ω–æ–∫–∞—Ä–¥–∏—è ‚Äî –±–æ–ª—å –≤ –≥—Ä—É–¥–∏ –∏–∑-–∑–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∞ –∫–∏—Å–ª–æ—Ä–æ–¥–∞ –≤ —Å–µ—Ä–¥–µ—á–Ω–æ–π –º—ã—à—Ü–µ."
            },
            {
                question: "–ö–∞–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç –≠–ö–ì —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–µ–ø–æ–ª—è—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–µ–¥—Å–µ—Ä–¥–∏–π?",
                answers: ["–ó—É–±–µ—Ü –†", "–ö–æ–º–ø–ª–µ–∫—Å QRS", "–ó—É–±–µ—Ü –¢", "–ò–Ω—Ç–µ—Ä–≤–∞–ª PQ"],
                correctAnswer: 0,
                hint: "–ó—É–±–µ—Ü –† –Ω–∞ –≠–ö–ì —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–µ–ø–æ–ª—è—Ä–∏–∑–∞—Ü–∏–∏ (—Å–æ–∫—Ä–∞—â–µ–Ω–∏—é) –ø—Ä–µ–¥—Å–µ—Ä–¥–∏–π."
            }
        ];

        // Game state variables
        let currentQuestionIndex = 0;
        let score = 0;
        let lives = 3;
        let hints = {
            fiftyFifty: 1,
            cheatSheet: 1,
            audience: 1
        };
        let gameActive = false;
        let selectedAnswer = false;

        // DOM Elements
        const welcomeScreen = document.getElementById('welcome-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const telegramBtn = document.getElementById('telegram-btn');
        const telegramLink = document.getElementById('telegram-link');
        
        const questionText = document.getElementById('question-text');
        const answersContainer = document.getElementById('answers-container');
        const currentQuestionEl = document.getElementById('current-question');
        const progressPercent = document.getElementById('progress-percent');
        const progressFill = document.querySelector('.progress-fill');
        
        const scoreEl = document.querySelector('.score');
        const livesEls = document.querySelectorAll('.life');
        
        const hint50Btn = document.getElementById('hint-50');
        const hintCheatBtn = document.getElementById('hint-cheat');
        const hintAudienceBtn = document.getElementById('hint-audience');
        const hint50Count = document.getElementById('hint-50-count');
        const hintCheatCount = document.getElementById('hint-cheat-count');
        const hintAudienceCount = document.getElementById('hint-audience-count');
        
        const rankTitle = document.getElementById('rank-title');
        const rankImage = document.getElementById('rank-image');
        const rankDescription = document.getElementById('rank-description');
        const finalScore = document.getElementById('final-score');
        const correctAnswers = document.getElementById('correct-answers');
        const livesLeft = document.getElementById('lives-left');
        
        const confettiContainer = document.getElementById('confetti-container');
        const loading = document.getElementById('loading');

        // Initialize the game
        function initGame() {
            currentQuestionIndex = 0;
            score = 0;
            lives = 3;
            selectedAnswer = false;
            hints = {
                fiftyFifty: 1,
                cheatSheet: 1,
                audience: 1
            };
            
            updateScore();
            updateLives();
            updateHints();
            
            welcomeScreen.style.display = 'flex';
            questionScreen.style.display = 'none';
            resultsScreen.style.display = 'none';
            
            // Reset confetti
            confettiContainer.style.display = 'none';
            confettiContainer.innerHTML = '';
            
            // Hide loading
            loading.style.display = 'none';
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É, –µ—Å–ª–∏ –µ—Å—Ç—å
            loadGame();
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Start the game
        function startGame() {
            gameActive = true;
            welcomeScreen.style.display = 'none';
            questionScreen.style.display = 'flex';
            resultsScreen.style.display = 'none';
            
            loadQuestion();
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã
            saveGame();
            
            // Send analytics to Telegram if in WebApp
            if (isTelegramWebApp) {
                Telegram.WebApp.sendData(JSON.stringify({action: 'game_started'}));
            }
        }

        // Load current question
        function loadQuestion() {
            if (currentQuestionIndex >= quizData.length) {
                endGame();
                return;
            }
            
            const question = quizData[currentQuestionIndex];
            questionText.textContent = question.question;
            currentQuestionEl.textContent = currentQuestionIndex + 1;
            
            // Calculate progress
            const progress = ((currentQuestionIndex) / quizData.length) * 100;
            progressPercent.textContent = Math.round(progress);
            progressFill.style.width = `${progress}%`;
            
            // Clear previous answers
            answersContainer.innerHTML = '';
            
            // Create answer buttons
            question.answers.forEach((answer, index) => {
                const answerBtn = document.createElement('button');
                answerBtn.className = 'answer-btn';
                answerBtn.textContent = answer;
                answerBtn.dataset.index = index;
                answerBtn.addEventListener('click', () => checkAnswer(index));
                answersContainer.appendChild(answerBtn);
            });
            
            // Enable all hint buttons if available
            updateHints();
            
            // Reset selected answer flag
            selectedAnswer = false;
            
            // Scroll to top of questions
            answersContainer.scrollTop = 0;
        }

        // Check answer
        function checkAnswer(selectedIndex) {
            if (!gameActive || selectedAnswer) return;
            
            selectedAnswer = true;
            const question = quizData[currentQuestionIndex];
            const answerBtns = document.querySelectorAll('.answer-btn');
            
            // Disable all buttons
            answerBtns.forEach(btn => {
                btn.style.pointerEvents = 'none';
            });
            
            // Highlight correct and incorrect answers
            answerBtns.forEach((btn, index) => {
                if (index === question.correctAnswer) {
                    setTimeout(() => {
                        btn.classList.add('correct');
                    }, 300);
                } else if (index === selectedIndex && selectedIndex !== question.correctAnswer) {
                    setTimeout(() => {
                        btn.classList.add('incorrect');
                    }, 300);
                }
            });
            
            // Check if answer is correct
            if (selectedIndex === question.correctAnswer) {
                score += 10;
                updateScore();
                
                // Vibrate on correct answer (if supported)
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                
                // Play success sound (simulated)
                playSound('correct');
            } else {
                lives--;
                updateLives();
                
                // Vibrate on wrong answer (if supported)
                if (navigator.vibrate) {
                    navigator.vibrate([50, 50, 50]);
                }
                
                // Play error sound (simulated)
                playSound('incorrect');
                
                // Check if game over
                if (lives <= 0) {
                    setTimeout(() => {
                        endGame();
                    }, 1200);
                    return;
                }
            }
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
            saveGame();
            
            // Move to next question after delay
            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizData.length && lives > 0) {
                    loadQuestion();
                } else {
                    endGame();
                }
            }, 1200);
        }

        // Update score display
        function updateScore() {
            scoreEl.textContent = score;
        }

        // Update lives display
        function updateLives() {
            livesEls.forEach((life, index) => {
                if (index < lives) {
                    life.classList.add('active');
                } else {
                    life.classList.remove('active');
                    // Add shake animation for lost life
                    if (index === lives) {
                        life.style.animation = 'shake 0.5s';
                        setTimeout(() => {
                            life.style.animation = '';
                        }, 500);
                    }
                }
            });
        }

        // Update hints display
        function updateHints() {
            hint50Count.textContent = `(${hints.fiftyFifty})`;
            hintCheatCount.textContent = `(${hints.cheatSheet})`;
            hintAudienceCount.textContent = `(${hints.audience})`;
            
            hint50Btn.disabled = hints.fiftyFifty <= 0;
            hintCheatBtn.disabled = hints.cheatSheet <= 0;
            hintAudienceBtn.disabled = hints.audience <= 0;
        }

        // 50/50 hint
        hint50Btn.addEventListener('click', () => {
            if (hints.fiftyFifty <= 0 || !gameActive || selectedAnswer) return;
            
            const question = quizData[currentQuestionIndex];
            const answerBtns = document.querySelectorAll('.answer-btn');
            let wrongAnswersRemoved = 0;
            
            // Remove two wrong answers
            answerBtns.forEach((btn, index) => {
                if (index !== question.correctAnswer && wrongAnswersRemoved < 2) {
                    btn.style.opacity = '0.3';
                    btn.style.pointerEvents = 'none';
                    wrongAnswersRemoved++;
                }
            });
            
            hints.fiftyFifty--;
            updateHints();
            playSound('hint');
            
            // Vibrate on hint use
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
            
            saveGame();
        });

        // Cheat sheet hint
        hintCheatBtn.addEventListener('click', () => {
            if (hints.cheatSheet <= 0 || !gameActive || selectedAnswer) return;
            
            const question = quizData[currentQuestionIndex];
            
            // Show hint as a temporary message
            const hintMessage = document.createElement('div');
            hintMessage.textContent = `–ü–æ–¥—Å–∫–∞–∑–∫–∞: ${question.hint}`;
            hintMessage.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: var(--cream);
                color: var(--violet);
                padding: 20px;
                border-radius: 15px;
                border: 3px solid var(--violet);
                z-index: 100;
                max-width: 90%;
                text-align: center;
                font-weight: bold;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                animation: fadeIn 0.3s;
                font-size: 1rem;
            `;
            
            document.body.appendChild(hintMessage);
            
            setTimeout(() => {
                hintMessage.remove();
            }, 3000);
            
            hints.cheatSheet--;
            updateHints();
            playSound('hint');
            
            // Vibrate on hint use
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
            
            saveGame();
        });

        // Audience help hint
        hintAudienceBtn.addEventListener('click', () => {
            if (hints.audience <= 0 || !gameActive || selectedAnswer) return;
            
            const question = quizData[currentQuestionIndex];
            const answerBtns = document.querySelectorAll('.answer-btn');
            
            // Generate random percentages (favoring correct answer)
            let percentages = [0, 0, 0, 0];
            let total = 0;
            
            // Give correct answer a higher base percentage
            percentages[question.correctAnswer] = Math.floor(Math.random() * 30) + 40; // 40-70%
            total += percentages[question.correctAnswer];
            
            // Distribute remaining percentage among wrong answers
            for (let i = 0; i < percentages.length; i++) {
                if (i !== question.correctAnswer) {
                    percentages[i] = Math.floor(Math.random() * (100 - total) / 3) + 5;
                    total += percentages[i];
                }
            }
            
            // Adjust to ensure total is 100
            const diff = 100 - total;
            if (diff !== 0) {
                percentages[question.correctAnswer] += diff;
            }
            
            // Display percentages on buttons
            answerBtns.forEach((btn, index) => {
                const percent = percentages[index];
                btn.innerHTML = `${btn.textContent} <br> <strong>${percent}%</strong>`;
                btn.style.fontSize = '0.9rem';
                
                // Add a small visual bar
                const bar = document.createElement('div');
                bar.style.cssText = `
                    width: ${percent}%;
                    height: 4px;
                    background-color: var(--violet);
                    margin-top: 5px;
                    border-radius: 2px;
                `;
                btn.appendChild(bar);
            });
            
            hints.audience--;
            updateHints();
            playSound('hint');
            
            // Vibrate on hint use
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
            
            saveGame();
        });

        // End the game
        function endGame() {
            gameActive = false;
            questionScreen.style.display = 'none';
            resultsScreen.style.display = 'flex';
            
            // Calculate results
            const correctCount = Math.floor(score / 10);
            const percentage = Math.round((correctCount / quizData.length) * 100);
            
            // Determine rank
            let rank, rankIcon, rankDesc;
            
            if (percentage <= 50) {
                rank = "–°–∞–Ω–∏—Ç–∞—Ä";
                rankIcon = "üßπ";
                rankDesc = "–ù—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª! –í—ã –æ—Ç–≤–µ—Ç–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –º–µ–Ω–µ–µ —á–µ–º –Ω–∞ 50% –≤–æ–ø—Ä–æ—Å–æ–≤.";
            } else if (percentage <= 75) {
                rank = "–í—Ä–∞—á";
                rankIcon = "üë®‚Äç‚öïÔ∏è";
                rankDesc = "–•–æ—Ä–æ—à–æ, –Ω–æ –µ—Å—Ç—å –ø—Ä–æ–±–µ–ª—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Å–ø–µ–∫—Ç –µ—â–µ —Ä–∞–∑.";
            } else if (percentage <= 90) {
                rank = "–î–æ–∫—Ç–æ—Ä –Ω–∞—É–∫";
                rankIcon = "üéì";
                rankDesc = "–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã —Ö–æ—Ä–æ—à–æ –∑–Ω–∞–µ—Ç–µ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—É—é —Å–∏—Å—Ç–µ–º—É.";
                playSound('levelup');
            } else {
                rank = "–ê–∫–∞–¥–µ–º–∏–∫";
                rankIcon = "üèÜ";
                rankDesc = "–ò–¥–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ —Ç–µ–º—ã! –í—ã –Ω–∞—Å—Ç–æ—è—â–∏–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ!";
                playSound('victory');
                createConfetti();
            }
            
            // Update results screen
            rankTitle.textContent = rank;
            rankImage.textContent = rankIcon;
            rankDescription.textContent = rankDesc;
            finalScore.textContent = score;
            correctAnswers.textContent = `${correctCount}/${quizData.length}`;
            livesLeft.textContent = lives;
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const finalResult = {
                score: score,
                rank: rank,
                date: new Date().toLocaleDateString(),
                percentage: percentage
            };
            localStorage.setItem('medquiz_last_result', JSON.stringify(finalResult));
            
            // –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
            localStorage.removeItem(SAVE_KEY);
            
            // Scroll to top
            resultsScreen.scrollTop = 0;
            
            // Send results to Telegram if in WebApp
            if (isTelegramWebApp) {
                const resultData = {
                    action: 'game_completed',
                    score: score,
                    correctAnswers: correctCount,
                    totalQuestions: quizData.length,
                    rank: rank,
                    percentage: percentage
                };
                Telegram.WebApp.sendData(JSON.stringify(resultData));
            }
        }

        // Create confetti animation
        function createConfetti() {
            confettiContainer.style.display = 'block';
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // Random color
                const colors = ['#ffd700', '#ff6b6b', '#51cf66', '#339af0', '#c8a2c8'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Random position
                confetti.style.left = Math.random() * 100 + '%';
                
                // Random size
                const size = Math.random() * 8 + 4;
                confetti.style.width = size + 'px';
                confetti.style.height = size + 'px';
                
                // Random animation
                const duration = Math.random() * 3 + 2;
                const delay = Math.random() * 1;
                
                confetti.style.animation = `
                    fall ${duration}s linear ${delay}s infinite,
                    sway ${duration/2}s ease-in-out ${delay}s infinite alternate
                `;
                
                // Add keyframes for animation
                const styleSheet = document.createElement('style');
                styleSheet.textContent = `
                    @keyframes fall {
                        0% { top: -10px; transform: rotate(0deg); }
                        100% { top: 100%; transform: rotate(360deg); }
                    }
                    @keyframes sway {
                        0% { transform: translateX(0px) rotate(0deg); }
                        100% { transform: translateX(${Math.random() * 100 - 50}px) rotate(180deg); }
                    }
                `;
                
                confettiContainer.appendChild(styleSheet);
                confettiContainer.appendChild(confetti);
            }
        }

        // Play sound effects
        function playSound(type) {
            // Simple sound simulation
            const sounds = {
                'correct': {freq: 800, duration: 200},
                'incorrect': {freq: 400, duration: 300},
                'hint': {freq: 600, duration: 150},
                'levelup': {freq: [800, 1000, 1200], duration: 500},
                'victory': {freq: [600, 800, 1000, 800, 600], duration: 800}
            };
            
            // –í –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ –∑–≤—É–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ Web Audio API
            if (window.AudioContext || window.webkitAudioContext) {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    const sound = sounds[type];
                    if (Array.isArray(sound.freq)) {
                        // –î–ª—è –º–µ–ª–æ–¥–∏–π –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É
                        oscillator.frequency.value = sound.freq[0];
                    } else {
                        oscillator.frequency.value = sound.freq;
                    }
                    
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + (sound.duration/1000));
                    
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + (sound.duration/1000));
                } catch(e) {
                    console.log('–ê—É–¥–∏–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                }
            }
        }

        // Handle link clicks in Telegram
        function handleLinkClick(event, url) {
            event.preventDefault();
            if (isTelegramWebApp) {
                Telegram.WebApp.openLink(url);
            } else if (!navigator.onLine) {
                alert('–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
            } else {
                window.open(url, '_blank');
            }
        }

        // Event listeners
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', initGame);
        
        telegramBtn.addEventListener('click', (e) => handleLinkClick(e, 'https://t.me/sea_sch'));
        telegramLink.addEventListener('click', (e) => handleLinkClick(e, 'https://t.me/sea_sch'));
        
        // Prevent context menu on mobile
        document.addEventListener('contextmenu', (e) => {
            if (e.target.tagName === 'BUTTON') {
                e.preventDefault();
            }
        });
        
        // Handle orientation change
        window.addEventListener('orientationchange', () => {
            // Small delay to allow CSS to adjust
            setTimeout(() => {
                window.scrollTo(0, 0);
            }, 100);
        });
        
        // Handle page visibility change
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && gameActive) {
                // Game paused - —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                saveGame();
            }
        });
        
        // Initialize the game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Show loading briefly for better UX
            loading.style.display = 'flex';
            
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –∏–≥—Ä—É
            loadGame();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É
            setTimeout(() => {
                initGame();
            }, 300);
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏
            if (isAppInstalled()) {
                console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            }
            
            // Handle back button on mobile
            if ('history' in window) {
                window.history.pushState(null, null, window.location.href);
                window.onpopstate = function() {
                    window.history.pushState(null, null, window.location.href);
                    if (gameActive && !confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏? –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω.')) {
                        return;
                    }
                };
            }
        });
        
        // Prevent accidental zoom on mobile
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>